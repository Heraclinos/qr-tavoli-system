class QRPointsSystem{constructor(){this.tables=[{id:1,name:"Tavolo 1",points:42,qrCode:"TABLE_1"},{id:2,name:"Tavolo 2",points:73,qrCode:"TABLE_2"},{id:3,name:"Tavolo 3",points:28,qrCode:"TABLE_3"},{id:4,name:"Tavolo 4",points:55,qrCode:"TABLE_4"},{id:5,name:"Tavolo 5",points:81,qrCode:"TABLE_5"},{id:6,name:"Tavolo 6",points:19,qrCode:"TABLE_6"},{id:7,name:"Tavolo 7",points:67,qrCode:"TABLE_7"},{id:8,name:"Tavolo 8",points:34,qrCode:"TABLE_8"},{id:9,name:"Tavolo 9",points:89,qrCode:"TABLE_9"},{id:10,name:"Tavolo 10",points:46,qrCode:"TABLE_10"}];this.currentUser=null;this.selectedTable=null;this.customerTable=null;this.medals=["ðŸ¥‡","ðŸ¥ˆ","ðŸ¥‰"];this.pointsPresets=[1,5,10,20];this.init()}init(){this.bindEvents();this.showScreen("loginScreen")}bindEvents(){document.getElementById("customerBtn").addEventListener("click",()=>this.selectRole("customer"));document.getElementById("cashierBtn").addEventListener("click",()=>this.selectRole("cashier"));document.getElementById("changeRoleBtn").addEventListener("click",()=>this.changeRole());document.getElementById("customerScanBtn").addEventListener("click",()=>this.customerScanQR());document.getElementById("customerQrInput").addEventListener("keypress",e=>{if(e.key==="Enter")this.customerScanQR()});document.getElementById("saveNameBtn").addEventListener("click",()=>this.saveTableName());document.getElementById("newTableNameInput").addEventListener("keypress",e=>{if(e.key==="Enter")this.saveTableName()});document.getElementById("newTableNameInput").addEventListener("input",()=>this.validateNameInput());document.getElementById("cashierScanBtn").addEventListener("click",()=>this.cashierScanQR());document.getElementById("cashierQrInput").addEventListener("keypress",e=>{if(e.key==="Enter")this.cashierScanQR()});document.getElementById("addCustomPointsBtn").addEventListener("click",()=>this.addCustomPoints());document.getElementById("customPointsInput").addEventListener("keypress",e=>{if(e.key==="Enter")this.addCustomPoints()});document.querySelectorAll(".points-btn").forEach(btn=>{btn.addEventListener("click",e=>this.addPresetPoints(parseInt(e.target.dataset.points)))})}selectRole(role){this.currentUser=role;document.getElementById("userRole").textContent=role==="cashier"?"ðŸ‘¨â€ðŸ’¼ Cassiere":"ðŸ‘¥ Cliente";document.getElementById("userRole").className=`user-role user-role--${role}`;document.getElementById("userRole").classList.remove("hidden");document.getElementById("changeRoleBtn").classList.remove("hidden");if(role==="customer"){this.showScreen("customerScreen");setTimeout(()=>{this.updateLeaderboard()},100)}else{this.showScreen("cashierScreen")}this.showToast(`Benvenuto nella dashboard ${role==="cashier"?"Cassiere":"Cliente"}!`,"info")}changeRole(){this.currentUser=null;this.selectedTable=null;this.customerTable=null;document.getElementById("userRole").classList.add("hidden");document.getElementById("changeRoleBtn").classList.add("hidden");this.resetCustomerForm();this.resetCashierForm();this.showScreen("loginScreen");this.showToast("Ruolo cambiato. Seleziona un nuovo ruolo.","info")}showScreen(screenId){document.querySelectorAll(".screen").forEach(screen=>{screen.classList.add("hidden")});document.getElementById(screenId).classList.remove("hidden")}customerScanQR(){const qrCode=document.getElementById("customerQrInput").value.trim().toUpperCase();if(!qrCode){this.showToast("Inserisci un codice QR valido","error");return}const table=this.tables.find(t=>t.qrCode===qrCode);if(!table){this.showToast("Codice QR non valido","error");return}this.customerTable=table;this.displayCustomerTable(table);this.updateLeaderboard();this.showToast(`Tavolo ${table.name} identificato!`,"success")}displayCustomerTable(table){document.getElementById("myTableName").textContent=table.name;document.getElementById("myTablePoints").textContent=`${table.points} punti`;document.getElementById("newTableNameInput").value=table.name;document.getElementById("myTableSection").classList.remove("hidden");this.validateNameInput()}validateNameInput(){const newName=document.getElementById("newTableNameInput").value.trim();const saveBtn=document.getElementById("saveNameBtn");if(this.customerTable&&newName&&newName!==this.customerTable.name&&newName.length>=3){saveBtn.disabled=false}else{saveBtn.disabled=true}}saveTableName(){if(!this.customerTable){this.showToast("Nessun tavolo selezionato","error");return}const newName=document.getElementById("newTableNameInput").value.trim();if(!newName||newName.length<3){this.showToast("Il nome deve avere almeno 3 caratteri","error");return}const existingTable=this.tables.find(t=>t.name.toLowerCase()===newName.toLowerCase()&&t.id!==this.customerTable.id);if(existingTable){this.showToast("Nome giÃ  utilizzato da un altro tavolo","error");return}const oldName=this.customerTable.name;this.customerTable.name=newName;document.getElementById("myTableName").textContent=newName;this.updateLeaderboard();this.showToast(`Tavolo rinominato da "${oldName}" a "${newName}"`,"success");document.getElementById("saveNameBtn").disabled=true}updateLeaderboard(){const sortedTables=[...this.tables].sort((a,b)=>b.points-a.points);const leaderboard=document.getElementById("leaderboard");if(!leaderboard)return;leaderboard.innerHTML="";sortedTables.forEach((table,index)=>{const position=index+1;const item=document.createElement("div");let itemClasses="leaderboard-item";if(position<=3){itemClasses+=` leaderboard-item--${this.getPositionSuffix(position)}`}if(this.customerTable&&table.id===this.customerTable.id){itemClasses+=" leaderboard-item--highlighted"}item.className=itemClasses;const medal=position<=3?`<span class="medal">${this.medals[position-1]}</span>`:"";item.innerHTML=`
                <div class="leaderboard-rank">
                    <div class="rank-number">${position}</div>
                    ${medal}
                    <div class="table-name-display">${table.name}</div>
                </div>
                <div class="table-points-display">
                    <span>${table.points}</span>
                    <span>punti</span>
                </div>
            `;leaderboard.appendChild(item)})}getPositionSuffix(position){switch(position){case 1:return"1st";case 2:return"2nd";case 3:return"3rd";default:return""}}cashierScanQR(){const qrCode=document.getElementById("cashierQrInput").value.trim().toUpperCase();if(!qrCode){this.showToast("Inserisci un codice QR valido","error");return}const table=this.tables.find(t=>t.qrCode===qrCode);if(!table){this.showToast("Codice QR non valido","error");return}this.selectedTable=table;this.displaySelectedTable(table);this.showToast(`Tavolo ${table.name} selezionato per gestione punti`,"success")}displaySelectedTable(table){document.getElementById("scannedTableName").textContent=table.name;document.getElementById("scannedTablePoints").textContent=`${table.points} punti`;document.getElementById("scannerResult").classList.remove("hidden");document.getElementById("pointsSection").classList.remove("hidden");document.getElementById("customPointsInput").value=""}addPresetPoints(points){if(!this.selectedTable){this.showToast("Seleziona prima un tavolo","error");return}this.addPointsToTable(this.selectedTable,points)}addCustomPoints(){if(!this.selectedTable){this.showToast("Seleziona prima un tavolo","error");return}const pointsInput=document.getElementById("customPointsInput");const points=parseInt(pointsInput.value);if(!points||points<1||points>100){this.showToast("Inserisci un numero di punti valido (1-100)","error");return}this.addPointsToTable(this.selectedTable,points);pointsInput.value=""}addPointsToTable(table,points){table.points+=points;document.getElementById("scannedTablePoints").textContent=`${table.points} punti`;if(this.customerTable&&this.customerTable.id===table.id){document.getElementById("myTablePoints").textContent=`${table.points} punti`;this.updateLeaderboard()}this.showToast(`${points} punti aggiunti al ${table.name}! Totale: ${table.points}`,"success")}resetCustomerForm(){document.getElementById("customerQrInput").value="";document.getElementById("myTableSection").classList.add("hidden");document.getElementById("newTableNameInput").value="";document.getElementById("saveNameBtn").disabled=true;this.customerTable=null}resetCashierForm(){document.getElementById("cashierQrInput").value="";document.getElementById("scannerResult").classList.add("hidden");document.getElementById("pointsSection").classList.add("hidden");document.getElementById("customPointsInput").value="";this.selectedTable=null}showToast(message,type="success"){const container=document.getElementById("toastContainer");if(!container)return;const toast=document.createElement("div");toast.className=`toast toast--${type}`;const icon=this.getToastIcon(type);toast.innerHTML=`
            <span>${icon}</span>
            <span>${message}</span>
        `;container.appendChild(toast);setTimeout(()=>{toast.classList.add("removing");setTimeout(()=>{if(toast.parentNode){toast.parentNode.removeChild(toast)}},300)},4e3)}getToastIcon(type){switch(type){case"success":return"âœ…";case"error":return"âŒ";case"info":return"â„¹ï¸";default:return"âœ…"}}getTableById(id){return this.tables.find(t=>t.id===id)}getTableByQRCode(qrCode){return this.tables.find(t=>t.qrCode===qrCode)}exportData(){return{tables:this.tables,currentUser:this.currentUser,selectedTable:this.selectedTable,customerTable:this.customerTable}}simulateScan(tableNumber){const qrCode=`TABLE_${tableNumber}`;if(this.currentUser==="customer"){document.getElementById("customerQrInput").value=qrCode;this.customerScanQR()}else if(this.currentUser==="cashier"){document.getElementById("cashierQrInput").value=qrCode;this.cashierScanQR()}}}document.addEventListener("DOMContentLoaded",()=>{window.qrSystem=new QRPointsSystem;console.log("ðŸ½ï¸ Sistema QR Punti Tavoli inizializzato");console.log("ðŸ’¡ Suggerimenti:");console.log("- Usa qrSystem.simulateScan(1) per simulare scansione TABLE_1");console.log("- Usa qrSystem.exportData() per vedere lo stato corrente");console.log("- QR codes disponibili: TABLE_1 fino a TABLE_10")});document.addEventListener("keydown",e=>{if(e.ctrlKey&&e.key>="1"&&e.key<="9"){e.preventDefault();if(window.qrSystem&&window.qrSystem.currentUser){const tableNumber=e.key==="0"?10:parseInt(e.key);window.qrSystem.simulateScan(tableNumber)}}});